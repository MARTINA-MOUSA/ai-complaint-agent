"""Prompt builders for text-based output."""

from __future__ import annotations

from textwrap import dedent

from .base import BASE_PERSONA, OUTPUT_REQUIREMENTS


def build_analysis_prompt(complaint: str, company: str, notes: str | None = None) -> str:
    """Build a single prompt that returns all analysis in plain Arabic text."""
    extra = f"\nملاحظات إضافية أو سياسات الشركة: {notes}" if notes else ""
    
    return dedent(
        f"""
        {BASE_PERSONA}
        {OUTPUT_REQUIREMENTS}

        قم بتحليل الشكوى التالية من العميل وقدم تحليلًا متكاملاً بالعربية.

        بيانات الشركة:
        - اسم الشركة: {company}
        - نص الشكوى: {complaint}
        {extra}

        المطلوب: اكتب تحليلاً متكاملاً بالعربية يحتوي على الأقسام التالية بالترتيب:

        ١. التصنيف
        حدد نوع الشكوى من: (مشكلة في التوصيل | مشكلة في الدفع | مشكلة تقنية | استفسار عام | استرجاع/استبدال | أخرى)
        واشرح بجملة واحدة سبب التصنيف.

        ٢. فهم المشاعر
        حدد المشاعر الأساسية للعميل (مثل: غضب، إحباط، قلق، خيبة أمل، رضا) واشرح كيف يجب التعامل معها.

        ٣. خطة المعالجة
        اكتب خطة حل عملية مكونة من 3-5 خطوات. لكل خطوة اذكر:
        - الإجراء المطلوب
        - المسؤول (مثل: فريق خدمة العملاء، قسم الشحن، إلخ)
        - الجدول الزمني (مثل: خلال 24 ساعة، خلال 3 أيام عمل)
        - معيار النجاح

        ٤. الرد الرسمي
        اكتب ردًا رسميًا للعميل بالعربية يتسم باللباقة والتعاطف ويوضح الحل. يجب أن:
        - يشكر العميل على تواصله
        - يعترف بمشاعره
        - يشرح الإجراءات التي ستتخذها الشركة
        - يقدم جدولًا زمنيًا واقعيًا
        - يقدم خيارات للتواصل المستقبلي

        استخدم الرمز | كفاصل عند عرض العناصر المسمى (مثال: التصنيف | مشكلة في التوصيل).

        اكتب التحليل كاملاً بالعربية بدون استخدام JSON أو أي تنسيق برمجي.
        """
    ).strip()
